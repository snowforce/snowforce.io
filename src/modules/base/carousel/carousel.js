import { LightningElement, api } from 'lwc';

import Flickity from 'flickity';

export default class BaseCarousel extends LightningElement {
  flkty;

  @api cells;

  @api
  get flktySetup() {
    return this._flktySetup;
  }
  set flktySetup(val) {
    if (!val) {
      return;
    }
    this._flktySetup = {
      ...val,
      arrowShape: this.getArrowShape(val.arrowShape)
    };
  }

  @api
  get activeIndex() {
    return this.flkty ? this.flkty.selectedIndex : this._activeIndex;
  }
  set activeIndex(val) {
    this._activeIndex = val;
    if (this.flkty) {
      this.flkty.selectCell(val);
    }
  }

  renderedCallback() {
    if (this.flkty || !this.flktySetup) {
      return;
    }
    const elem = this.template.querySelector('.main-carousel');
    this.flkty = new Flickity(elem, this.flktySetup);

    this.flkty.append(this.cells());

    if (this._activeIndex) {
      this.flkty.selectCell(this._activeIndex);
    }

    this.flkty.on('change', index => {
      this.template.querySelector('.main-carousel').dispatchEvent(
        new CustomEvent('carouselchange', {
          bubbles: true,
          composed: true,
          detail: { index }
        })
      );
    });
  }

  getArrowShape = shapeName => {
    if (shapeName in this.arrowShapes) {
      return this.arrowShapes[shapeName];
    }
    return this.arrowShapes;
  };

  // 100x100 viewport
  arrowShapes = {
    arrow: 'M 0,50 L 60,00 L 50,30 L 80,30 L 80,70 L 50,70 L 60,100 Z',
    snowflake:
      'M28.98 1.97c-.24.39-.22.6.12 1.94.44 1.69 1.96 6.04 3.27 9.35.47 1.18.86 2.21.86 2.3 0 .08-1.01-.37-2.25-.99-2.41-1.21-2.73-1.25-3.77-.52-.64.43-1.46 2.09-1.46 2.94 0 1.23 1.81 2.54 7.33 5.27.18.09 1.1.55 2.75 1.37.56 1.24.87 1.93.94 2.07 1.62 3.67 6.45 16.28 6.34 16.57-.04.08-1.11-.35-2.4-.95-1.62-.77-2.45-1.25-2.67-1.63-.84-1.27-1.93-3.85-3.99-9.55-.43-1.16-.82-1.26-2.92-.7-2.17.56-2.48.86-2.32 2.3.06.55.38 1.76.68 2.7.3.95.52 1.76.47 1.79-.15.15-6.72-3.01-7.04-3.38-.58-.69-2.04-3.84-3.18-6.77-1.22-3.18-1.44-3.44-2.54-3.09-1.03.34-2.72 1.22-3.18 1.67-.57.52-.55.74.13 2.73.3.91.52 1.68.5 1.72-.04.03-2.15-.92-4.67-2.1-2.59-1.2-4.85-2.15-5.17-2.15-.77 0-1.57.97-2.66 3.27-1.1 2.27-1.15 2.88-.29 3.52.86.66 3.44 1.93 7.33 3.59 1.85.81 3.44 1.52 3.52 1.59.09.08-.88.58-2.15 1.12-1.28.53-2.42 1.11-2.55 1.28-.15.2-.21.56-.15.97.13.84.99 2.99 1.37 3.4.56.62.45.66 10.01-2.69.07-.02.42-.14 1.06-.36 1.02.41 1.59.63 1.7.68.94.37 2.38.99 3.24 1.38.1.05.61.29 1.54.71-.98.31-1.52.47-1.63.51-.9.26-1.76.61-1.91.78-.37.38-.37 1.41-.02 2.6.17.51.37 1.24.47 1.61.37 1.4 1.14 1.33 7.14-.71.25-.08 1.47-.49 3.67-1.23 1.54.73 2.39 1.13 2.56 1.21 1.39.69 2.47 1.29 2.4 1.33-.64.39-13.98 5.42-18.48 6.98-.11.03-.61.21-1.52.52-1.39-.8-2.16-1.24-2.32-1.33-3.95-2.22-6.12-3.25-6.62-3.12-.3.07-.79.6-1.41 1.55-.82 1.25-.95 1.57-.95 2.4 0 1.14.13 1.27 2.34 2.3 1.4.65 1.63.8 1.31.95-.21.07-1.63.62-3.14 1.2-1.54.58-4.01 1.57-5.52 2.22-3.3 1.39-3.41 1.52-2.96 3.35.41 1.57 1.7 4.17 2.28 4.56.47.3.64.25 6.57-1.98 3.33-1.27 6.12-2.24 6.17-2.21.06.06-.37.94-.95 1.97s-1.05 2.04-1.05 2.26c0 .86 2.66 2.83 3.84 2.83 1.03 0 2.17-1.59 4.69-6.59.9-1.77 1.76-3.25 2-3.4 1.41-.92 18.3-7.26 18.58-6.98.19.19-1.48 4.15-1.96 4.68-.66.73-4.47 2.6-8.42 4.15-2.56 1.01-3.28 1.38-3.44 1.72-.17.39-.08.73.76 2.39.75 1.52 1.07 1.99 1.43 2.08.56.13 2-.26 4.04-1.14.84-.34 1.47-.52 1.44-.41-.73 1.74-3.07 6.45-3.3 6.64-.84.65-3.63 1.89-6.51 2.84-1.77.58-3.35 1.16-3.49 1.31-.4.32-.38 1.03.11 2.94.5 2.07.8 2.39 2.09 2.22.53-.07 1.67-.37 2.55-.67.88-.28 1.61-.5 1.64-.49.06.08-1.38 3.3-2.93 6.57-1.5 3.1-1.63 3.7-.94 4.23.9.67 4.43 2.41 4.94 2.41.77 0 1.5-.62 2.43-2.13.84-1.37 2.36-4.59 3.37-7.19.35-.87.58-1.27.67-1.12.1.13.43.99.75 1.93.79 2.22.96 2.41 2.06 2.28 1.31-.17 3.29-1.12 3.57-1.72.3-.65-.17-2.49-1.53-6.17-1.57-4.21-1.55-3.5-.1-6.94.7-1.63 1.33-3.05 1.41-3.13.07-.09.37.51.63 1.33.28.83.64 1.61.79 1.74.39.32 2.26.11 3.37-.37 1.19-.54 1.76-1.09 1.76-1.72 0-.73-.79-3.18-1.93-5.97-.52-1.29-.94-2.43-.94-2.52 0-.12.53-1.41 1.18-2.9l1.44-3.37c.21-.49.32-.56.43-.37.1.14 1.35 3.64 2.81 7.76.18.5 1.06 2.99 2.66 7.48-1.47 2.92-2.29 4.54-2.45 4.86-1.35 2.7-2.46 5.05-2.46 5.26 0 .52.15.67 1.59 1.63 1.09.73 1.46.87 2.17.87 1.18 0 1.76-.61 3.02-3.16.06-.13.38-.77.95-1.94.2.55.32.85.34.91.18.51 1.1 3.02 2.06 5.6 3.66 10.02 4.09 10.94 5.08 10.66 1.24-.37 5.41-2.06 5.6-2.28.11-.13.19-.49.19-.77-.02-.28-1.26-3.83-2.74-7.89-1.47-4.06-2.67-7.43-2.63-7.47.03-.03.61.25 1.29.62 1.42.81 1.94.84 2.62.21.69-.66 2-3.44 1.87-3.97-.13-.47-3.97-2.79-6.93-4.21-1.83-.88-1.81-.86-3.46-4.95-.93-2.32-4.47-11.77-4.47-11.92 0-.04.99.34 2.21.86 1.2.51 2.62 1.11 3.16 1.29.73.28 1.12.6 1.61 1.26.92 1.23 2.34 4.19 3.52 7.22 1.14 2.97 1.21 3.04 2.9 2.6 2.07-.53 3.07-1.29 3.07-2.3 0-.29-.25-1.24-.57-2.16-.29-.91-.56-1.68-.56-1.7 0-.02 1.46.6 3.26 1.39.22.09 1.31.56 3.27 1.4.61 1.3.95 2.02 1.01 2.17.56 1.2 1.52 3.35 2.12 4.79 1.33 3.25 1.4 3.35 2.5 3.2.96-.14 3.26-1.43 3.58-2.01.26-.5.09-1.64-.47-3.03l-.45-1.08c.24.08.37.12.39.13.23.07 1.97.86 3.88 1.78 3.27 1.57 3.49 1.64 4.15 1.47 1.12-.31 2-1.6 2.75-4 .5-1.64.5-2.02-.09-2.6-.57-.56-3.2-1.89-6.8-3.38-1.36-.58-2.61-1.13-2.76-1.22-.21-.11.39-.41 2.02-1.07 2.9-1.12 3.05-1.23 2.91-2.28-.09-.84-.97-2.82-1.64-3.66-.51-.64-.96-.62-2.66.16-2.47 1.11-7.52 3.09-7.95 3.09-.47 0-7.15-2.8-7.15-2.99 0-.08.23-.21.53-.28.28-.06 1.27-.49 2.22-.94 1.39-.65 1.74-.9 1.86-1.29.2-.86-.58-3.16-1.39-4.09-.58-.66-2.13-.27-7.46 1.92-.19.08-1.14.47-2.85 1.16-1.55-.62-2.41-.96-2.58-1.03-3.1-1.25-4.41-1.83-4.32-1.9.04-.04 2.58-.96 5.65-2.06 3.09-1.11 7.03-2.55 8.79-3.22 1.76-.65 3.67-1.38 4.27-1.61.07-.02.42-.16 1.05-.39 3.22 1.59 5.01 2.48 5.37 2.66 2.93 1.45 5.55 2.65 5.78 2.65.52 0 .78-.3 1.77-2 .9-1.55 1-2.41.36-2.99-.24-.21-1.27-.86-2.3-1.46-3.09-1.8-3.01-1.74-2.71-1.85.14-.06 1.55-.56 3.08-1.13 5.17-1.85 7.84-2.99 8.57-3.62.45-.4.39-1.09-.17-2.7-.76-2.15-1.53-3.51-2.04-3.7-.69-.26-3.66.67-10.44 3.29-.3.11-.28 0 .15-.86.62-1.22.53-1.93-.33-2.77-.64-.6-2.04-1.33-2.62-1.34-1.2-.02-2.66 1.92-4.19 5.55l-.9 2.13c-1.97.77-3.06 1.19-3.28 1.27C72.44 37.43 57.61 43 57.46 43c-.15 0 .45-1.36.75-1.68.15-.17.28-.5.28-.77.01-2.15 3.01-4.32 8.28-5.98 1.37-.45 2.59-.88 2.74-.99.43-.34.16-2.57-.49-3.82-.82-1.61-1.18-1.72-3.39-.99-.97.32-1.79.56-1.83.52-.15-.15 2.24-5.46 2.62-5.78.69-.59 5.14-2.69 8.06-3.79 1.55-.58 2.98-1.22 3.18-1.42.32-.32.34-.43.13-1.43-.46-2.24-.84-3.1-1.44-3.29-.73-.24-2.34.1-4.38.92-.87.35-1.6.63-1.64.63-.08 0 .24-.71 2.41-5.33 1.11-2.35 2.02-4.5 2.02-4.77 0-1.12-1.29-2.32-3.65-3.38-.67-.3-1.4-.54-1.64-.54-1.01 0-2.21 1.83-4.47 6.86-.83 1.83-1.52 3.37-1.57 3.4-.04.04-.44-.72-.9-1.72-1.07-2.32-1.14-2.33-3.63-1.08-1.48.73-1.93 1.07-2.02 1.42-.13.56.2 1.63 1.74 5.28.63 1.57 1.18 3.06 1.18 3.32 0 .79-1.05 3.39-2.46 6.07-.72 1.4-1.38 2.6-1.45 2.67-.06.07-.42-.79-.75-1.93-.84-2.69-.96-2.78-3.07-2.33-3.2.69-3.39.93-2.68 3.49.27.98 1 3.15 1.63 4.85.62 1.7 1.18 3.27 1.24 3.51.09.4-1.5 4.42-1.82 4.62-.07.06-.58-1.16-1.12-2.67-.54-1.52-2.23-6.14-3.78-10.27-.19-.5-1.12-3-2.79-7.5l2.08-4.19 2.09-4.19c-.16-.39-.26-.61-.28-.65-.35-.88-1.27-1.43-2.99-1.8-1.81-.39-2.08-.24-2.94 1.72-.33.79-.67 1.35-.75 1.27-.07-.07-.41-.95-.74-1.92-1-2.85-3.18-8.48-3.48-8.94-.23-.34-.43-.42-1.16-.4-.49 0-1.28.13-1.74.26-1.72.47-3.58 1.3-3.86 1.71z'
  };
}
